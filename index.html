
<html>
<head>
    <title>Web JukeBox</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" />
    <link rel="stylesheet" href="css/webJukebox.css" />
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/jquery.mobile-1.3.1.min.js"></script>
    <!-- <script src="js/jquery.blockUI.js"></script> -->
</head>

<body>

<div data-role="page" id="page1">

    <div id="header" data-theme="a" data-role="header" class="header">
        <span class="ui-title">Web JukeBox
        </span>
    </div>

    <ul data-role="listview" class="ui-listview">
        <li data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="c" class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-count ui-btn-up-c">
            <div class="ui-btn-inner ui-li">
                <div class="ui-btn-text">
                    <a href="javascript:" class="ui-link-inherit song1" onclick="cast_vote('1')">
                        <div></div>
                    </a>
                </div>
            </div>
            <span class="ui-li-count ui-btn-up-c ui-btn-corner-all" id="vote1"></span>
        </li>

        <li data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="c" class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-count ui-btn-up-c">
            <div class="ui-btn-inner ui-li">
                <div class="ui-btn-text">
                    <a href="javascript:" class="ui-link-inherit song2" onclick="cast_vote('2')">
                        <div></div>
                    </a>
                </div>
            </div>
            <span class="ui-li-count ui-btn-up-c ui-btn-corner-all" id="vote2"></span>
        </li>

        <li data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="c" class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-count ui-btn-up-c">
            <div class="ui-btn-inner ui-li">
                <div class="ui-btn-text">
                    <a href="javascript:" class="ui-link-inherit song3" onclick="cast_vote('3')">
                        <div></div>
                    </a>
                </div>
            </div>
            <span class="ui-li-count ui-btn-up-c ui-btn-corner-all" id="vote3"></span>
        </li>
    </ul>
     <div data-theme="a" data-role="footer" data-position="fixed">
        <h3>
            <a data-role="button" href="javascript:" id="skip">
                Skip
            </a>
        </h3>
    </div>
    
</div>
<div class="modal"><h1></h1></div>

<a href="login_controller_template.php" data-rel="dialog" data-transition="flip" id="login_link">Open dialog</a>
<script type="text/javascript">
    $(function(){
        $('#login_link').hide();
        $('#skip').on('click',function(){
            thinking_overlay();
            update_queue(true);
        });
        update_queue(true);
        window.setInterval(function(){update_queue(false)},4000);
    });

    function remove_overlay(){
       $('html').removeClass("loading"); 
    }

    function thinking_overlay(){
        $('.modal h1').html('Loading Next Vote');
        $('html').addClass("loading");
    }

    function go_dance_overlay(){
        $('.modal h1').html('Go Dance');
        $('html').addClass("loading");
    }

    function cast_vote(vote_for){
        thinking_overlay();
        $.ajax({
            url: 'rpc/cast_vote.php',
            type: 'POST',
            data: {vote_for: vote_for}
        }).done(function(){
            update_queue(true);
            remove_overlay();//move this to a 'complete' function
        });
    }

    function update_queue(advance_by_one){
        advance_by_one = (typeof advance_by_one === 'undefined') ? false : advance_by_one;
        advance_by_one = (advance_by_one) ? true : false ;
        $.ajax({
            url: 'rpc/update_queue.php',
            type: 'POST',
            data: { advance_by_one: advance_by_one},
        }).done(function(result){
            if(result.update_list){
                thinking_overlay();
                $('.song1 div').html(result.song1);
                $('.song2 div').html(result.song2);
                $('.song3 div').html(result.song3);
                $('#vote1').html(result.vote1);
                $('#vote2').html(result.vote2);
                $('#vote3').html(result.vote3);
                remove_overlay();
            }else if(result.max_entropy){
                go_dance_overlay();
            }
        }).error(function(){
            alert('there was a problem');
        })
    }
</script>

</body>
</html>