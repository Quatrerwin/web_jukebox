
<html>
<head>
    <link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" />
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/jquery.mobile-1.3.1.min.js"></script>
    <!-- <script src="js/jquery.blockUI.js"></script> -->
</head>

<body>

<div data-role="page" id="page1">

    <div id="header" data-theme="a" data-role="header" class="header">
        <span class="ui-title">Web JukeBox
        </span>
    </div>
   
<ul data-role="listview" class="ui-listview">
    <li data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="c" class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-count ui-btn-up-c">
        <div class="ui-btn-inner ui-li">
            <div class="ui-btn-text">
                <a href="javascript:" class="ui-link-inherit song1" onclick="cast_vote('1')">
                    <div></div>
                    <span class="ui-li-count ui-btn-up-c ui-btn-corner-all" id="vote1"></span>
                </a>
            </div>
        </div>
    </li>

    <li data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="c" class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-count ui-btn-up-c">
        <div class="ui-btn-inner ui-li">
            <div class="ui-btn-text">
                <a href="javascript:" class="ui-link-inherit song2" onclick="cast_vote('2')">
                    <div></div>
                    <span class="ui-li-count ui-btn-up-c ui-btn-corner-all" id="vote2"></span>
                </a>
            </div>
        </div>
    </li>

    <li data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="c" class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-count ui-btn-up-c">
        <div class="ui-btn-inner ui-li">
            <div class="ui-btn-text">
                <a href="javascript:" class="ui-link-inherit song3" onclick="cast_vote('3')">
                    <div></div>
                    <span class="ui-li-count ui-btn-up-c ui-btn-corner-all" id="vote3"></span>
                </a>
            </div>
        </div>
    </li>

</ul>
    </div>

</div>
<script type="text/javascript">
    $(function(){
 //       login_overlay();
        update_queue(false);
        window.setInterval(function(){update_queue(false)},5000);
    });

    function remove_overlay(){
       // $.unblockUI();
    }

    function login_overlay(){
      //  $.blockUI({ message: $('#loginForm') }); 
    }

    function thinking_overlay(){
        //check if the blockUI is alread up if not set it
        //add overlay class to body with thinking icon
      //  $.blockUI({ overlayCSS: { backgroundColor: '#00f' } });
    }

    function go_dance_overlay(){
        //check if the blockUI is alread up if not set it
        //add overlay letting people to go out and dance
      //  $.blockUI({ overlayCSS: { backgroundColor: '#00f' } });
        //change this to a simple show hide of two divs
    }

    function cast_vote(vote_for){
        thinking_overlay();
        $.ajax({
            url: 'rpc/cast_vote.php',
            type: 'POST',
            data: {vote_for: vote_for, id_hash: $('#id_hash').val()}
        }).done(function(){
            update_queue(true);
            remove_overlay();//move this to a 'complete' function
        });
    }

    function update_queue(advance_by_one){
        advance_by_one = (typeof advance_by_one === 'undefined') ? false : advance_by_one;
        $.ajax({
            url: 'rpc/update_queue.php',
            type: 'POST',
            data: { id_hash: $('#id_hash').val(), advance_by_one: advance_by_one},
        }).done(function(result){
            if(result.update_list){
                thinking_overlay();
                $('.song1 div').html(result.song1);
                $('.song2 div').html(result.song2);
                $('.song3 div').html(result.song3);
                $('#vote1').html(result.vote1);
                $('#vote2').html(result.vote2);
                $('#vote3').html(result.vote3);
                //update vote stuff
                $('#hash_id').val(result.hash_id);
                remove_overlay();
            }else if(result.max_entropy){
                go_dance_overlay();
            }
        }).error(function(){
            alert('there was a problem');
        })
    }
</script>

</body>
</html>